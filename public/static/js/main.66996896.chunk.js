(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{224:function(e,t,n){},237:function(e,t,n){"use strict";n.r(t);var a=n(83),s=n.n(a),c=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,264)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),a(e),s(e),c(e),r(e)}))},r=n(0),o=n(44),i=n(19),l=n(253),j=(n(223),n(224),n(17)),u=n(33),b=n(202),d=n(4),m={user:null};if(localStorage.getItem("jwtToken")){var O=Object(b.a)(localStorage.getItem("jwtToken"));1e3*O.exp<Date.now()?localStorage.removeItem("jwtToken"):m.user=O}var h=Object(r.createContext)({user:null,login:function(e){},logout:function(){}});function p(e,t){switch(t.type){case"LOGIN":return Object(u.a)(Object(u.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(u.a)(Object(u.a)({},e),{},{user:null});default:return e}}function x(e){var t=Object(r.useReducer)(p,m),n=Object(j.a)(t,2),a=n[0],s=n[1];return Object(d.jsx)(h.Provider,Object(u.a)({value:{user:a.user,login:function(e){localStorage.setItem("jwtToken",e.token),s({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),s({type:"LOGOUT"})}}},e))}var g=n(210);var f=function(e){var t=e.component,n=Object(g.a)(e,["component"]),a=Object(r.useContext)(h).user;return Object(d.jsx)(i.b,Object(u.a)(Object(u.a)({},n),{},{render:function(e){return a?Object(d.jsx)(i.a,{to:"/"}):Object(d.jsx)(t,Object(u.a)({},e))}}))},v=n(256);var C,y=function(){var e=Object(r.useContext)(h),t=e.user,n=e.logout,a=window.location.pathname,s="/"===a?"home":a.substr(1),c=Object(r.useState)(s),i=Object(j.a)(c,2),l=i[0],u=i[1],b=function(e,t){var n=t.name;return u(n)};return t?Object(d.jsxs)(v.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(d.jsx)(v.a.Item,{name:t.username,active:!0,as:o.b,to:"/"}),Object(d.jsx)(v.a.Menu,{position:"right",children:Object(d.jsx)(v.a.Item,{name:"logout",onClick:n})})]}):Object(d.jsxs)(v.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(d.jsx)(v.a.Item,{name:"home",active:"home"===l,onClick:b,as:o.b,to:"/"}),Object(d.jsxs)(v.a.Menu,{position:"right",children:[Object(d.jsx)(v.a.Item,{name:"login",active:"login"===l,onClick:b,as:o.b,to:"/login"}),Object(d.jsx)(v.a.Item,{name:"register",active:"register"===l,onClick:b,as:o.b,to:"/register"})]})]})},I=n(22),w=n(262),k=n(257),P=n(259),S=n(208),$=n(254),N=n(260),A=n(113),L=n(158),D=n(122),M=n.n(D),T=n(31),Q=n(18),E=function(e){var t=e.content,n=e.children;return Object(d.jsx)($.a,{inverted:!0,content:t,trigger:n})};var R,F,q,z=Object(Q.a)(C||(C=Object(T.a)(["\n  mutation likePost($postId: ID!) {\n    likePost(postId: $postId) {\n      id\n      likes {\n        id\n        username\n      }\n      likeCount\n    }\n  }\n"]))),B=function(e){var t=e.user,n=e.post,a=n.id,s=n.likeCount,c=n.likes,i=Object(r.useState)(!1),l=Object(j.a)(i,2),u=l[0],b=l[1];Object(r.useEffect)((function(){t&&c.find((function(e){return e.username===t.username}))?b(!0):b(!1)}),[t,c]);var m=Object(I.useMutation)(z,{variables:{postId:a}}),O=Object(j.a)(m,1)[0],h=t?u?Object(d.jsx)(N.a,{color:"teal",children:Object(d.jsx)(A.a,{name:"heart"})}):Object(d.jsx)(N.a,{color:"teal",basic:!0,children:Object(d.jsx)(A.a,{name:"heart"})}):Object(d.jsx)(N.a,{as:o.b,to:"/login",color:"teal",basic:!0,children:Object(d.jsx)(A.a,{name:"heart"})});return Object(d.jsxs)(N.a,{as:"div",labelPosition:"right",onClick:O,children:[Object(d.jsx)(E,{content:u?"Un-like":"Like",children:h}),Object(d.jsx)(L.a,{basic:!0,color:"teal",pointing:"left",children:s})]})},G=n(124),H=n(258),U=Object(Q.a)(R||(R=Object(T.a)(["\n  {\n    getPosts{\n    id body createdAt username likeCount\n    likes{\n      username\n    }\n      commentCount\n      comments{\n        id username createdAt body\n      }\n    }\n  }\n"]))),J=Object(Q.a)(F||(F=Object(T.a)(["\n  mutation deletePost($postId: ID!){\n    deletePost(postId: $postId)\n  }\n"]))),V=Object(Q.a)(q||(q=Object(T.a)(["\n  mutation deleteComment($postId: ID!, $commentId: ID!){\n    deleteComment(postId: $postId, commentId: $commentId){\n      id\n      comments{\n        id username createdAt body\n      }\n      commentCount\n    }\n  }\n"]))),W=function(e){var t=e.postId,n=e.commentId,a=e.callback,s=Object(r.useState)(!1),c=Object(j.a)(s,2),o=c[0],i=c[1],l=n?V:J,b=Object(I.useMutation)(l,{update:function(e){if(i(!1),!n){var s=e.readQuery({query:U}),c=Object(G.a)(s.getPosts);c=[c.filter((function(e){return e.id!==t}))].concat(Object(G.a)(c)),e.writeQuery({query:U,data:Object(u.a)(Object(u.a)({},s),{},{getPosts:{newData:c}})})}a&&a()},variables:{postId:t,commentId:n}}),m=Object(j.a)(b,1)[0];return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(E,{content:n?"Delete comment":"Delete post",children:Object(d.jsx)(N.a,{as:"div",color:"red",floated:"right",onClick:function(){return i(!0)},children:Object(d.jsx)(A.a,{name:"trash",style:{margin:"0px"}})})}),Object(d.jsx)(H.a,{open:o,onCancel:function(){return i(!1)},onConfirm:m})]})};var K,X=function(e){var t=e.post,n=t.body,a=t.createdAt,s=t.id,c=t.username,i=t.likeCount,l=t.commentCount,j=t.likes,u=Object(r.useContext)(h).user;return Object(d.jsxs)(P.a,{fluid:!0,children:[Object(d.jsxs)(P.a.Content,{children:[Object(d.jsx)(S.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),Object(d.jsx)(P.a.Header,{children:c}),Object(d.jsx)(P.a.Meta,{as:o.b,to:"/posts/".concat(s),children:M()(a).fromNow()}),Object(d.jsx)(P.a.Description,{children:n})]}),Object(d.jsxs)(P.a.Content,{extra:!0,children:[Object(d.jsx)($.a,{content:"Like a post",inverted:!0,trigger:Object(d.jsx)(B,{user:u,post:{id:s,likes:j,likeCount:i}})}),Object(d.jsx)(E,{content:"Comment on post",children:Object(d.jsxs)(N.a,{labelPosition:"right",as:o.b,to:"/posts/".concat(s),children:[Object(d.jsx)(N.a,{color:"blue",basic:!0,children:Object(d.jsx)(A.a,{name:"comments"})}),Object(d.jsx)(L.a,{basic:!0,color:"blue",pointing:"left",children:l})]})}),u&&u.username===c&&Object(d.jsx)(W,{postId:s})]})]})},Y=n(255),Z=n(134),_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(r.useState)(t),a=Object(j.a)(n,2),s=a[0],c=a[1],o=function(e){c(Object(u.a)(Object(u.a)({},s),{},Object(Z.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:o,onSubmit:i,values:s}};var ee,te,ne,ae,se=Object(Q.a)(K||(K=Object(T.a)(["\n  mutation createPost($body: String!) {\n    createPost(body: $body){\n      id body createdAt username\n      likes{\n        id username createdAt\n      }\n      likeCount\n      comments{\n        id body createdAt username\n      }\n      commentCount\n    }\n  }\n"]))),ce=function(){var e=_((function(){r()}),{body:""}),t=e.values,n=e.onChange,a=e.onSubmit,s=Object(I.useMutation)(se,{variables:t,update:function(e,n){var a=e.readQuery({query:U});e.writeQuery({query:U,data:{getPosts:[n.data.createPost].concat(Object(G.a)(a.getPosts))}}),t.body=""}}),c=Object(j.a)(s,2),r=c[0],o=c[1].error;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)(Y.a,{onSubmit:a,children:[Object(d.jsx)("h2",{children:"Create a post: "}),Object(d.jsxs)(Y.a.Field,{children:[Object(d.jsx)(Y.a.Input,{placeholder:"Hi World",name:"body",onChange:n,value:t.body,error:!!o}),Object(d.jsx)(N.a,{type:"submit",color:"teal",children:"Submit"})]})]}),o&&Object(d.jsx)("div",{className:"ui error message",style:{marginBottom:"20px"},children:Object(d.jsx)("ul",{className:"list",children:Object(d.jsx)("li",{children:o.graphQLErrors[0].message})})})]})},re=function(){var e=Object(r.useContext)(h).user,t=Object(I.useQuery)(U),n=t.loading,a=t.data,s=(a=void 0===a?{}:a).getPosts;return Object(d.jsxs)(w.a,{columns:3,children:[Object(d.jsx)(w.a.Row,{className:"page-title",children:Object(d.jsx)("h1",{children:"Recent Posts"})}),Object(d.jsxs)(w.a.Row,{children:[e&&Object(d.jsx)(w.a.Column,{children:Object(d.jsx)(ce,{})}),n?Object(d.jsx)("h1",{children:"Loading posts.."}):Object(d.jsx)(k.a.Group,{children:s&&s.map((function(e){return Object(d.jsx)(w.a.Column,{style:{marginBottom:"1rem"},children:Object(d.jsx)(X,{post:e})},e.id)}))})]})]})},oe=Object(Q.a)(ee||(ee=Object(T.a)(["\n  mutation login(\n    $username: String!\n    $password: String!\n  ) {\n    login(\n        username: $username\n        password: $password\n    ){\n      id email username createdAt token\n    }\n  }\n"]))),ie=function(e){var t=Object(r.useContext)(h),n=Object(r.useState)({}),a=Object(j.a)(n,2),s=a[0],c=a[1],o=_((function(){O()}),{username:"",password:""}),i=o.onChange,l=o.onSubmit,u=o.values,b=Object(I.useMutation)(oe,{update:function(n,a){var s=a.data.login;t.login(s),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:u}),m=Object(j.a)(b,2),O=m[0],p=m[1].loading;return Object(d.jsxs)("div",{className:"form-container",children:[Object(d.jsxs)(Y.a,{onSubmit:l,noValidate:!0,className:p?"loading":"",children:[Object(d.jsx)("h1",{children:"Login"}),Object(d.jsx)(Y.a.Input,{label:"username",placeholder:"Username...",name:"username",type:"text",value:u.username,error:!!s.username,onChange:i}),Object(d.jsx)(Y.a.Input,{label:"password",placeholder:"Password...",name:"password",type:"password",value:u.password,error:!!s.password,onChange:i}),Object(d.jsx)(N.a,{type:"submit",primary:!0,children:"Login"})]}),Object.keys(s).length>0&&Object(d.jsx)("div",{className:"ui error message",children:Object(d.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(d.jsx)("li",{children:e},e)}))})})]})},le=Object(Q.a)(te||(te=Object(T.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      registerInput: {\n        username: $username\n        email: $email\n        password: $password\n        confirmPassword: $confirmPassword\n      }\n    ){\n      id email username createdAt token\n    }\n  }\n"]))),je=function(e){var t=Object(r.useContext)(h),n=Object(r.useState)({}),a=Object(j.a)(n,2),s=a[0],c=a[1],o=_((function(){O()}),{username:"",email:"",password:"",confirmPassword:""}),i=o.onChange,l=o.onSubmit,u=o.values,b=Object(I.useMutation)(le,{update:function(n,a){var s=a.data.register;t.login(s),e.history.push("/")},onError:function(e){c(e.graphQLErrors[0].extensions.exception.errors)},variables:u}),m=Object(j.a)(b,2),O=m[0],p=m[1].loading;return Object(d.jsxs)("div",{className:"form-container",children:[Object(d.jsxs)(Y.a,{onSubmit:l,noValidate:!0,className:p?"loading":"",children:[Object(d.jsx)("h1",{children:"Register"}),Object(d.jsx)(Y.a.Input,{label:"username",placeholder:"Username...",name:"username",type:"text",value:u.username,error:!!s.username,onChange:i}),Object(d.jsx)(Y.a.Input,{label:"email",placeholder:"Email...",name:"email",type:"email",value:u.email,error:!!s.email,onChange:i}),Object(d.jsx)(Y.a.Input,{label:"password",placeholder:"Password...",name:"password",type:"password",value:u.password,error:!!s.password,onChange:i}),Object(d.jsx)(Y.a.Input,{label:"Confirm Password",placeholder:"Confirm Password...",name:"confirmPassword",type:"password",value:u.confirmPassword,error:!!s.confirmPassword,onChange:i}),Object(d.jsx)(N.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(s).length>0&&Object(d.jsx)("div",{className:"ui error message",children:Object(d.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(d.jsx)("li",{children:e},e)}))})})]})},ue=Object(Q.a)(ne||(ne=Object(T.a)(["\n  mutation($postId: String!, $body: String!) {\n    createComment(postId: $postId, body: $body){\n      id\n      comments{\n        id body createdAt username\n      }\n      commentCount\n    }\n  }\n"]))),be=Object(Q.a)(ae||(ae=Object(T.a)(["\n  query($postId: ID!){\n    getPost(postId: $postId){\n      id body createdAt username likeCount\n      likes{\n        username\n      }\n      commentCount\n      comments {\n        id username createdAt body\n      }\n    }\n  }\n"]))),de=function(e){var t=e.match.params.postId,n=Object(r.useContext)(h).user,a=Object(r.useState)(""),s=Object(j.a)(a,2),c=s[0],o=s[1],i=Object(r.useRef)(null);console.log(t);var l,u=Object(I.useQuery)(be,{variables:{postId:t}}).data,b=(u=void 0===u?{}:u).getPost,m=Object(I.useMutation)(ue,{update:function(){o(""),i.current.blur()},variables:{postId:t,body:c}}),O=Object(j.a)(m,1)[0];function p(){e.history.push("/")}if(b){var x=b.id,g=b.body,f=b.createdAt,v=b.username,C=b.comments,y=b.likes,k=b.likeCount,$=b.commentCount;l=Object(d.jsx)(w.a,{children:Object(d.jsxs)(w.a.Row,{children:[Object(d.jsx)(w.a.Column,{width:2,children:Object(d.jsx)(S.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right"})}),Object(d.jsxs)(w.a.Column,{width:10,children:[Object(d.jsxs)(P.a,{fluid:!0,children:[Object(d.jsxs)(P.a.Content,{children:[Object(d.jsx)(P.a.Header,{children:v}),Object(d.jsx)(P.a.Meta,{children:M()(f).fromNow()}),Object(d.jsx)(P.a.Description,{children:g})]}),Object(d.jsx)("hr",{}),Object(d.jsxs)(P.a.Content,{extra:!0,children:[Object(d.jsx)(B,{user:n,post:{id:x,likeCount:k,likes:y}}),Object(d.jsx)(E,{content:"Comment on post",children:Object(d.jsxs)(N.a,{as:"div",labelPosition:"right",onClick:function(){return console.log("Comment on post")},children:[Object(d.jsx)(N.a,{basic:!0,color:"blue",children:Object(d.jsx)(A.a,{name:"comments"})}),Object(d.jsx)(L.a,{basic:!0,color:"blue",pointing:"left",children:$})]})}),n&&n.username===v&&Object(d.jsx)(W,{postId:x,callback:p})]})]}),n&&Object(d.jsx)(P.a,{fluid:!0,children:Object(d.jsxs)(P.a.Content,{children:[Object(d.jsx)("p",{children:"Post a comment..."}),Object(d.jsx)(Y.a,{children:Object(d.jsxs)("div",{className:"ui action input fluid",children:[Object(d.jsx)("input",{type:"text",placeholder:"Comment...",name:"comment",value:c,onChange:function(e){return o(e.target.value)},ref:i}),Object(d.jsx)("button",{type:"submit",className:"ui button teal",disabled:""===c.trim(),onClick:O,children:"Submit"})]})})]})}),C.map((function(e){return Object(d.jsx)(P.a,{fluid:!0,children:Object(d.jsxs)(P.a.Content,{children:[n&&n.username===e.username&&Object(d.jsx)(W,{postId:x,commentId:e.id,callback:p}),Object(d.jsx)(P.a.Header,{children:e.username}),Object(d.jsx)(P.a.Meta,{children:M()(e.createdAt).fromNow()}),Object(d.jsx)(P.a.Description,{children:e.body})]})},e.id)}))]})]})})}else console.log("what the fuck"),l=Object(d.jsx)("p",{children:"Loading post...."});return l};var me=function(){return Object(d.jsx)(x,{children:Object(d.jsx)(o.a,{children:Object(d.jsxs)(l.a,{children:[Object(d.jsx)(y,{}),Object(d.jsx)(i.b,{exact:!0,path:"/",component:re}),Object(d.jsx)(f,{exact:!0,path:"/login",component:ie}),Object(d.jsx)(f,{exact:!0,path:"/register",component:je}),Object(d.jsx)(i.b,{exact:!0,path:"/posts/:postId",component:de})]})})})},Oe=n(209),he=Object(I.createHttpLink)({uri:"https://social-media-merng-app.herokuapp.com"}),pe=Object(Oe.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),xe=new I.ApolloClient({link:pe.concat(he),cache:new I.InMemoryCache}),ge=Object(d.jsx)(I.ApolloProvider,{client:xe,children:Object(d.jsx)(me,{})});s.a.render(ge,document.getElementById("root")),c()}},[[237,1,2]]]);
//# sourceMappingURL=main.66996896.chunk.js.map